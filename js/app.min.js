"use strict";$(function(){var e={names:{},captionFocus:!1,init:function(){$(".disContentWrapper").addClass("is-textSelected"),$(".disContentWrapper p").attr("contenteditable",!0),e.insertRow();var t=$(".is-selected");t.focus(),e.showPlusBtn(t,"text")},resetSelect:function(e){e.removeClass("is-selected");var t=e.parents(".disContentWrapper");t.removeClass("is-textSelected is-mediaSelected")},select:function(e,t){var i=e.parents(".disContentWrapper");i.children().removeClass("is-selected"),e.addClass("is-selected"),i.removeClass("is-textSelected is-mediaSelected"),i.addClass("is-"+t+"Selected")},isEmpty:function(e){return!e||0===e.length},showPlusBtn:function(t,i){var n=(t.parents(".disContentWrapper"),$(".disInlineMenuWrapper")),s="";switch(n.attr("style","top:"+t.offset().top+"px;left:"+(t.offset().left-40)+"px;"),i){case"text":s=t.html(),e.isEmpty(s)?n.show():(n.hide(),e.resetInlineMenu());break;case"media":n.hide(),e.resetInlineMenu()}},toggleInlineMenu:function(t){var i=$(".disInlineMenu"),n=$(".is-selected"),s="";t.hasClass("fa-plus")?(t.removeClass("fa-plus"),t.addClass("fa-close"),i.show(),e.changePlaceholder(n,"")):(t.removeClass("fa-close"),t.addClass("fa-plus"),i.hide(),s=e.checkIfFirstElement(n)?"Tell your story...":"",e.changePlaceholder(n,s))},resetInlineMenu:function(){var e=$(".disPlusBtn"),t=$(".disInlineMenu");e.removeClass("fa-close"),e.addClass("fa-plus"),t.hide()},checkIfFirstElement:function(e){return e.is(":first-child")},insertRow:function(){var t=$(".is-selected"),i=e.generateUniqueName();e.names[i]={type:"text",content:""};var n="";e.isEmpty(t)?$(".disContentWrapper").append('<p class="dis--p is-selected" placeholder="'+n+'" name="'+i+'"></p>'):(t.removeClass("is-selected"),t.after('<p class="dis--p is-selected" placeholder="'+n+'" name="'+i+'"></p>')),t=$(".is-selected"),n=e.checkIfFirstElement(t)?"Tell your story...":"",t.attr("placeholder",n),t.attr("contenteditable",!0),$(".is-selected").focus()},sortRows:function(){var t=Object.keys(e.names),i="[name='"+t.join("'], [name='")+"']",n={};return $(i).each(function(t){var i=$(this).attr("name");n[i]=e.names[i]}),n},deleteRow:function(){var t=$(".is-selected"),i="",n=null;if(t.hasClass("dis--p")){if(i=t.html(),e.isEmpty(i))return e.checkIfFirstElement(t)?(e.removeRowAndName(t),e.insertRow()):(n=t.prev(),n.hasClass("dis--image")||n.hasClass("dis--video")||n.hasClass("dis--embed")||n.hasClass("dis--hr")?(e.removeRowAndName(n),t.focus()):(e.removeRowAndName(t),n.focus(),e.placeCaretAtEnd(n[0]))),!1}else e.removeRowAndName(t),e.insertRow()},deleteSelectedRow:function(){var t=$(".is-selected");return(t.hasClass("dis--image")||t.hasClass("dis--video")||t.hasClass("dis--embed"))&&(e.removeRowAndName(t),e.checkIfFirstElement(t)&&e.insertRow()),!0},removeRowAndName:function(t){var i=t.attr("name");delete e.names[i],t.prev(".clearfix").remove(),t.remove()},removePlaceholder:function(e){e.text().replace(" ","").length||e.empty()},changePlaceholder:function(e,t){e.attr("placeholder",t)},placeCaretAtEnd:function(e){if(e.focus(),"undefined"!=typeof window.getSelection&&"undefined"!=typeof document.createRange){var t=document.createRange();t.selectNodeContents(e),t.collapse(!1);var i=window.getSelection();i.removeAllRanges(),i.addRange(t)}else if("undefined"!=typeof document.body.createTextRange){var n=document.body.createTextRange();n.moveToElementText(e),n.collapse(!1),n.select()}},checkContent:function(){var t,i=$(".is-selected"),n=i.html(),s="",a={},r=0,o="";n.match("http(s)?://(www.)?youtube|youtu.be")?(n.match("embed")?a.id=n.split(/embed\//)[1].split('"')[0]:a.id=n.split(/v\/|v=|youtu\.be\//)[1].split(/[?&]/)[0],a.provider="youtube",o="https://www.youtube.com/embed/"+a.id+"?rel=0",r=1):(t=n.match(/vimeo.com\/(\d+)/))?(a.provider="vimeo",a.id=t[1],o="http://player.vimeo.com/video/"+a.id,r=1):(t=n.match(/twitter.com\/(\w+)/))&&(a.provider="twitter",a.id=t[1],r=2),1==r?(i=$(".is-selected"),s=i.attr("name"),e.names[s]={type:"video",provider:a.provider,url:o,alignment:"in-center",caption:""},i.replaceWith('<figure tabindex="0" class="dis--video is-selected" name="'+s+'"></figure>'),i=$(".is-selected"),i.append('<div class="iframeContainer"><iframe width="700" height="394" src="'+o+'" frameborder="0"></iframe></div><figcaption class="imageCaption" contenteditable="true" placeholder="Type caption for embed (optional)"></figcaption>')):2==r&&(i=$(".is-selected"),s=i.attr("name"),e.names[s]={type:"embed",provider:a.provider,twitter_account:a.id},$.ajax({url:"user_show.php?sn="+a.id,dataType:"json",success:function(e){i.replaceWith('<figure tabindex="0" class="dis--embed is-first-selected" name="'+s+'"></figure>'),i=$(".is-first-selected"),i.append('<div class="embedContainer">	<a href="https://twitter.com/'+e.name+'" class="twitterDetail" title="https://twitter.com/'+e.name+'">		<strong class="">'+e.name+" (@"+e.screen_name+') | Twitter</strong><br/>		<em class="">The latest Tweets from '+e.name+" (@"+e.screen_name+"). "+e.description+'</em>twitter.com	<a href="https://twitter.com/'+e.name+'" class="imageTwitterBanner" title="https://twitter.com/'+e.name+'" style="background-image: url('+e.profile_banner_url+');"></a></div>'),i.removeClass("is-first-selected"),i=$(".is-selected"),i.focus()},error:function(e,t,i){}}))},toggleMTMenu:function(t,i){var n=$(".disInlineMediaTransformMenu");e.repositionMTMenu(t,n);var t=null;"show"==i?(n.show(),t=$(".is-selected")):n.hide()},repositionMTMenu:function(e,t){var i=(e.outerWidth()-t.outerWidth())/2+e.offset().left;t.attr("style","top:"+(e.offset().top+20)+"px;left:"+i+"px;")},resetMTButton:function(){$('[data-action="media-transform"]').removeClass("is-active")},setMTButton:function(e){$('[data-action="media-transform"][data-action-value="'+e+'"]').addClass("is-active")},resetMediaTransform:function(){var e=$(".is-selected");e.prev(".clearfix").remove(),e.removeClass("dis--layoutOutsetLeft dis--layoutOutsetCenter dis--layoutFillWidth"),e.find("iframe").attr("width",525)},setMediaTransform:function(t,i){var n=i.data("action-value");t.data("layout-value",n);var s=t.parents(".disContentWrapper");switch(e.setNameAttr(t,{alignment:n}),n){case"out-left":t.before('<div class="clearfix"></div>'),t.addClass("dis--layoutOutsetLeft"),t.find("iframe").attr("width",525),t.find("iframe").attr("height",295);break;case"in-center":t.find("iframe").attr("width",700),t.find("iframe").attr("height",394);break;case"out-center":t.addClass("dis--layoutOutsetCenter"),t.find("iframe").attr("width",1015),t.find("iframe").attr("height",571);break;case"fillwidth":t.addClass("dis--layoutFillWidth"),t.find("iframe").attr("width",1280),t.find("iframe").attr("height",720),s.attr("style","width: 100% !important;")}},generateUniqueName:function(){var t="",i=Object.keys(e.names);do t=("0000"+(Math.random()*Math.pow(36,4)<<0).toString(36)).slice(-4);while(0==$.inArray(t,i));return t},setNameAttr:function(t,i){var n=t.attr("name");for(var s in i)e.names[n][s]=i[s]},showInlineHighlightMenu:function(e){$(".disInlineHighlightMenu").show()},attachWysiwyg:function(e){e.wysiwyg({classes:"some-more-classes",position:"selection",buttons:{bold:{title:"Bold",image:"",hotkey:"b"},italic:{title:"Italic",image:"",hotkey:"i"},insertlink:{title:"Insert link",image:""},h1:{title:"H1",image:"",click:function(t){"h1"==e[0].firstChild.localName?e.html(e[0].firstChild.innerHTML):e.wysiwyg("format","h1")}},h2:{title:"H2",image:"",click:function(t){"h2"==e[0].firstChild.localName?e.html(e[0].firstChild.innerHTML):e.wysiwyg("format","h2")}},blockquote:{title:"Blockquote",image:"",click:function(t){"blockquote"==e[0].firstChild.localName?e.html(e[0].firstChild.innerHTML):e.wysiwyg("format","blockquote")}},removeformat:{title:"Remove format",image:""}},submit:{title:"Submit",image:""},placeholderUrl:"Paste or type a link"})}};$(document).keydown(function(t){switch(t.keyCode){case 13:return 13!=t.which;case 8:if(!e.captionFocus)return e.deleteRow();break;case 46:return e.deleteSelectedRow()}}),$("body").on("focus click",".disContentWrapper p",function(t){var i=$(this);e.resetSelect(i),e.toggleMTMenu(i,"hide"),e.resetMTButton(),e.select(i,"text"),e.showPlusBtn(i,"text"),e.attachWysiwyg(i)}).on("cut paste copy keyup",".disContentWrapper p.is-selected",function(t){var i=$(this),n="";switch(t.keyCode){case 13:return e.checkContent(),e.insertRow(),13!=t.which;default:n=i.html(),e.setNameAttr(i,{content:n})}e.showPlusBtn(i,"text")}).on("focusout",".disContentWrapper p.is-selected",function(t){var i=$(this);e.removePlaceholder(i)}).on("click",".disContentWrapper>figure",function(t){var i=$(this);if(e.select(i,"media"),e.showPlusBtn(i,"media"),!i.hasClass("dis--embed")){e.toggleMTMenu(i,"show");var n=i.data("action-value");void 0==n&&(n="in-center"),e.resetMTButton(),e.setMTButton(n)}}).on("click",'[data-action="media-transform"]',function(t){t.preventDefault();var i=$(this),n=$(".is-selected"),s=i.data("action-value"),a=$(".disInlineMediaTransformMenu");e.select(n,"media"),e.resetMediaTransform(),e.setMediaTransform(n,i),e.resetMTButton(),void 0==s&&(s="in-center"),e.setMTButton(s),e.repositionMTMenu(n,a)}).on("keyup",".disContentWrapper>figure",function(t){switch(t.keyCode){case 13:return e.insertRow(),13!=t.which}}).on("click",".disPlusBtn",function(t){var i=$(this);e.toggleInlineMenu(i)}).on("click",".disImageBtn",function(e){$(".disContentWrapper").append('<input type="file" name="test" class="dis--imagefile" style="display: none;" />'),$('.dis--imagefile[type="file"]').trigger("click")}).on("click",".disVideoBtn",function(t){var i=$(".disPlusBtn");e.toggleInlineMenu(i);var n=$(".is-selected");e.changePlaceholder(n,"Paste a YouTube, Vine, Vimeo, or other video link, and press Enter"),n.focus()}).on("click",".disEmbedBtn",function(t){var i=$(".disPlusBtn");e.toggleInlineMenu(i);var n=$(".is-selected");e.changePlaceholder(n,"Paste a link to embed content from another site (e.g. Twitter) and press Enter"),n.focus()}).on("click",".disHrBtn",function(t){var i=$(".is-selected"),n=i.attr("name");e.names[n]={type:"hr"},i.replaceWith('<hr class="section-divider is-selected dis--hr" name="'+n+'"></h2>'),e.resetInlineMenu(),e.insertRow()}).on("focus",".disContentWrapper .imageCaption",function(t){e.captionFocus=!0}).on("focusout",".disContentWrapper .imageCaption",function(t){var i=$(this);e.removePlaceholder(i),e.captionFocus=!1}).on("cut paste copy keyup",".disContentWrapper .imageCaption",function(t){var i=$(".is-selected"),n=$(this)[0].innerText;$(this).html(n),e.setNameAttr(i,{caption:n})}).on("change",'.dis--imagefile[type="file"]',function(t){var i=$(".is-selected");$(this).addImage(this,i);e.showPlusBtn(i,"media")}).on("click",".disSubmitBtn",function(t){var i=e.sortRows(),n=JSON.stringify(i),s=document.createElement("form");s._submit_function_=s.submit,s.setAttribute("method","POST"),s.setAttribute("action","process.php");var a=document.createElement("input");a.type="hidden",a.name="data",a.value=n,s.appendChild(a),s.submit(),document.body.removeChild(s)}),e.init(),$.fn.extend({addImage:function(t){if(t.files&&t.files[0]){var i=new FileReader;t.getAttribute("id");i.onload=function(t){var i=new Image;i.src=t.target.result,i.onload=function(){var t=this.src,i=$(".is-selected"),n=i.attr("name");e.names[n]={type:"image",src:t,width:this.width,height:this.height,alignment:"in-center",caption:""},i.replaceWith('<figure tabindex="0" class="dis--image is-selected" name="'+n+'"></figure>'),i=$(".is-selected"),i.append('<div><img src="'+t+'" /></div><figcaption class="imageCaption" contenteditable="true" placeholder="Type caption for image (optional)"></figcaption>'),$('.dis--imagefile[type="file"]').remove(),e.insertRow()}},i.readAsDataURL(t.files[0])}}})});